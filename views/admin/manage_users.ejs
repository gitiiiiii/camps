<html>
    <body>
        
</html>

<%- include('../partials/header', { user: user, page: 'dashboard' }) %>

<div class="page-header">
  <h1>Manage Users</h1>
  <p>Add, edit, or remove all user accounts.</p>
</div>

<div class="container" style="display: flex; flex-wrap: wrap; gap: 2rem;">

  <!-- Add User Form -->
  <div style="flex: 1; min-width: 300px;">
    <div class="content-card" style="padding: 2.5rem;">
      <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--primary-blue);">Add New User</h3>
      <form action="/admin/users" method="POST">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required>
        </div>
        <div class="form-group">
          <label for="role">Role</label>
          <select id="role" name="role" required>
            <option value="user">User (Student/Faculty)</option>
            <option value="driver">Driver</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <button type="submit" class="auth-button">Create User</button>
      </form>
    </div>
  </div>

  <!-- Existing Users Table (UPDATED) -->
  <div style="flex: 2; min-width: 400px;">
    <div class="content-card">
      <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem;">All Users</h3>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Route Assigned</th> <!-- NEW -->
            <th>Actions</th>        <!-- NEW -->
          </tr>
        </thead>
        <tbody>
          <% if (!users || users.length === 0) { %>
            <tr><td colspan="5">No users found.</td></tr> <!-- Colspan changed to 5 -->
          <% } else { %>
            <% users.forEach(u => { %>
              <tr>
                <td><%= u.name %></td>
                <td><%= u.email %></td>
                <td><%= u.role %></td>
                <!-- NEW: Show the populated route name -->
                <td><%= u.route ? u.route.name : 'N/A' %></td>
                <!-- NEW: Add Edit button -->
                <td>
                  <a href="/admin/users/edit/<%= u._id %>" class="btn" style="background-color: #ffc107; color: black; padding: 0.5rem 1rem; text-decoration: none;">
                    Edit
                  </a>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

</div>

<%- include('../partials/footer') %>

</body>
</html>