<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Driver Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <%- include('../partials/header') %>

  <div class="max-w-6xl mx-auto py-10 px-6">
    <h1 class="text-3xl font-bold text-blue-700 mb-6">Driver Management</h1>

    <!-- Add Driver Form -->
    <div class="bg-white p-6 rounded-lg shadow mb-8">
      <h2 class="text-xl font-semibold mb-4">Add New Driver</h2>
      <form action="/admin/drivers/add" method="POST" class="grid md:grid-cols-2 gap-4">
        <input type="text" name="name" placeholder="Driver Name" class="border rounded p-2" required>
        <input type="text" name="licenseNumber" placeholder="License Number" class="border rounded p-2" required>
        <input type="text" name="phone" placeholder="Phone Number" class="border rounded p-2" required>
        <input type="text" name="assignedRoute" placeholder="Assigned Route" class="border rounded p-2">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded mt-2 hover:bg-blue-700">
          Add Driver
        </button>
      </form>
    </div>

    <!-- Driver List -->
    <div class="bg-white p-6 rounded-lg shadow mb-10">
      <h2 class="text-xl font-semibold mb-4">Existing Drivers</h2>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-blue-100 text-left">
            <th class="p-3 border">Name</th>
            <th class="p-3 border">License</th>
            <th class="p-3 border">Phone</th>
            <th class="p-3 border">Route</th>
            <th class="p-3 border text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (drivers.length > 0) { %>
            <% drivers.forEach(driver => { %>
              <tr class="hover:bg-gray-50">
                <td class="p-3 border"><%= driver.name %></td>
                <td class="p-3 border"><%= driver.licenseNumber %></td>
                <td class="p-3 border"><%= driver.phone %></td>
                <td class="p-3 border"><%= driver.assignedRoute || "N/A" %></td>
                <td class="p-3 border text-center">
                  <a href="/admin/drivers/delete/<%= driver._id %>" class="text-red-600 hover:underline">Delete</a>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="5" class="text-center text-gray-500 py-4">No drivers found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <!-- ðŸš DRIVER PANEL SECTION -->
    <div class="bg-white p-6 rounded-lg shadow">
      <h1 class="text-2xl font-bold mb-4 text-blue-700">Driver Panel</h1>

      <button id="updateLocation" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Update My Current Location
      </button>

      <p id="status" class="mt-3 text-gray-700"></p>

      <script>
      document.getElementById('updateLocation').addEventListener('click', () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(async (pos) => {
            const { latitude, longitude } = pos.coords;
            const res = await fetch('/driver/update-location', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ latitude, longitude })
            });
            const data = await res.json();
            document.getElementById('status').innerText = data.message || 'Location Updated!';
          }, (err) => {
            document.getElementById('status').innerText = 'Error getting location: ' + err.message;
          });
        } else {
          document.getElementById('status').innerText = 'Geolocation not supported in your browser';
        }
      });
      </script>
    </div>

  </div>

  <%- include('../partials/footer') %>
</body>
</html>
